var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var Game;!function(t){var e=function(t){function e(){t.call(this),this.skinName="Game.CarSkin"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.allGroup.y=-150},n.changeWay=function(t){t?this.allGroup.x=0:this.allGroup.x=-70},e}(eui.Component);t.Car=e,egret.registerClass(e,"Game.Car")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(){t.call(this),this.skinName="Game.RoadSkin"}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);t.Road=e,egret.registerClass(e,"Game.Road")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(){t.call(this),this.PreX=0,this.PreY=0,this.Rot=0,this.PreRotation=0,this.CircleX=100,this.CireclY=100,this.AddRot=9,this.skinName="Game.CarSteeringSkin",this.width=100,this.height=100}__extends(e,t);var i=(__define,e),n=i.prototype;return n.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.touchDown=function(t){console.log("down:"+t.localX+" "+t.localY);var e=t.stageX-this.CircleX-this.x,i=t.stageY-this.CireclY-this.y;this.PreX=e/Math.sqrt(e*e+i*i),this.PreY=i/Math.sqrt(e*e+i*i),this.PreRotation=this.calculateRotation(e,i),console.log("now rotation:"+this.PreRotation)},n.touchMove=function(t){t.touchDown&&console.log("move:"+t.localX+" "+t.localY);var e=t.stageX-this.CircleX-this.x,i=t.stageY-this.CireclY-this.y;this.PreX=e/Math.sqrt(e*e+i*i),this.PreY=i/Math.sqrt(e*e+i*i);var n=this.calculateRotation(e,i),s=n-this.PreRotation;this.PreRotation=n,this.Rot+=s,this.Rot<=-540?(this.Steering.rotation=-540,this.Rot=-540):this.Rot>=540?(this.Steering.rotation=540,this.Rot=540):this.Steering.rotation+=s,console.log("now rotation:"+this.Rot+" ;and resultRotation:"+s)},n.addRot=function(t,e){if(t){var i=this.Rot;this.Rot-=(1+e)*this.AddRot,this.Rot<=-540&&(this.Rot=-540),i>0&&this.Rot<0&&(this.Rot=0)}else{var i=this.Rot;this.Rot+=(1+e)*this.AddRot,this.Rot>=540&&(this.Rot=540),this.Rot>0&&0>i&&(this.Rot=0)}this.Steering.rotation=this.Rot},n.touchUp=function(t){console.log("up:"+t.localX+" "+t.localY),this.PreX=0,this.PreY=0,this.PreRotation=0},n.touchUpOut=function(t){console.log("out:"+t.localX+" "+t.localY),this.PreX=0,this.PreY=0,this.PreRotation=0},n.calculateRotation=function(t,e){var i=Math.floor(this.PreRotation/360),n=this.PreRotation%360;if(0>i&&0!=n&&(i+=1),0==t)return e>0?0>n?360*i-270:360*i+90:0>n?360*i-90:360*i+270;if(0==e)return t>=0?n>270?360*i+360:-270>n?360*i-360:360*i:n>0?360*i+180:360*i-180;var s=e/t,a=Math.atan(s)/Math.PI*180;return a>0?n>=-10&&100>n?360*i+a:n>=170&&280>n?360*i+180+a:n>-190&&-80>n?360*i-180+a:360*i-360+a:n>80&&190>n?360*i+180+a:n>-280&&-170>n?360*i-180+a:n>260&&360>n||n>0&&10>n&&i>=1?360*i+360+a:360*i+a},e}(eui.Component);t.Steering=e,egret.registerClass(e,"Game.Steering")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(){t.call(this),this.skinName="Game.SuccessSkin"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.Confirm.name="success",this.TimeLabel.text="0",this.Collision.text="0"},n.setTimeLabel=function(t){this.TimeLabel.text=t+""},n.setCollision=function(t){this.Collision.text=t+""},n.confirmFunction=function(){this.parent.removeChild(this)},e}(eui.Component);t.Success=e,egret.registerClass(e,"Game.Success")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(){t.call(this),this.skinName="Game.WarningSkin"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.Confirm.name="warning"},n.confirmFunction=function(){this.parent.removeChild(this)},e}(eui.Component);t.Warning=e,egret.registerClass(e,"Game.Warning")}(Game||(Game={}));var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1,this.OldRot=0,this.TimeLimit=101,this.Turns=0,this.TurnsLimit=.04,this.DetectTime=30,this.TurnTimeLimit=30,this.SpeedTimeLimit=30,this.MoveTime=100,this.Speed=0,this.MaxSpeed=10,this.SpeedAdd=.08,this.collision=0,this.TurnInterval=null,this.SpeedInterval=null,this.MoveInterval=null,this.TurnParams=420,this.StageWidth=480,this.StageHeight=800,this.DetectInterval=null,this.CarLenth=150,this.CarMinLenth=16,this.CarWidth=70,this.WheelDis=25,this.R=0,this.LeftFlag=!0,this.AddRotation=5.5,this.IsCrash=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},n.initGame=function(){document.title="车轮考驾照-直角驾驶",this.Speed=0,this.collision=0,this.Car.rotation=0,this.Steering.Rot=-1,this.TurnCalculate(this),this.Car.leftWheel.rotation=0,this.Car.rightWheel.rotation=0,this.Steering.Rot=0,this.Steering.Steering.rotation=0,this.StartTime=(new Date).getTime(),this.Car.x=50,this.Car.y=this.StageHeight-50},n.drawCar=function(){var t=new Game.Car;t.x=50,t.y=this.StageHeight-50,t.height=-this.CarLenth,t.changeWay(!0),this.addChild(t),this.Car=t},n.drawButton=function(){this.ForwardButton=new eui.Button,this.ForwardButton.skinName="Game.ForwardButtonSkin",this.ForwardButton.name="forward",this.ForwardButton.x=this.StageWidth-115-85,this.ForwardButton.y=525,this.ForwardButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.SpeedFunction,this),this.ForwardButton.addEventListener(egret.TouchEvent.TOUCH_END,this.StopSpeedFunction,this),this.ForwardButton.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.StopSpeedFunction,this),this.addChild(this.ForwardButton),this.LeftButton=new eui.Button,this.LeftButton.skinName="Game.ForwardButtonSkin",this.LeftButton.rotation=-90,this.LeftButton.x=this.StageWidth-295,this.LeftButton.y=700,this.LeftButton.name="left",this.LeftButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.TurnFunction,this),this.LeftButton.addEventListener(egret.TouchEvent.TOUCH_END,this.StopTurnFunction,this),this.LeftButton.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.StopTurnFunction,this),this.addChild(this.LeftButton),this.RightButton=new eui.Button,this.RightButton.skinName="Game.ForwardButtonSkin",this.RightButton.rotation=90,this.RightButton.y=615,this.RightButton.x=this.StageWidth-20,this.RightButton.name="right",this.RightButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.TurnFunction,this),this.RightButton.addEventListener(egret.TouchEvent.TOUCH_END,this.StopTurnFunction,this),this.RightButton.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.StopTurnFunction,this),this.addChild(this.RightButton),this.BackButton=new eui.Button,this.BackButton.skinName="Game.ForwardButtonSkin",this.BackButton.name="back",this.BackButton.rotation=180,this.BackButton.x=this.StageWidth-200+85,this.BackButton.y=790,this.BackButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.SpeedFunction,this),this.BackButton.addEventListener(egret.TouchEvent.TOUCH_END,this.StopSpeedFunction,this),this.BackButton.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.StopSpeedFunction,this),this.addChild(this.BackButton),this.StopButton=new eui.Button,this.StopButton.skinName="Game.StopButtonSkin",this.StopButton.x=this.StageWidth-115-85,this.StopButton.y=615,this.StopButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.Stop,this),this.addChild(this.StopButton),this.Steering=new Game.Steering,this.Steering.x=this.StageWidth-5-100,this.Steering.y=this.StageHeight-290,this.addChild(this.Steering)},n.startCreateScene=function(){this.WarnPanel=new Game.Warning,this.WarnPanel.Confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hidePannel,this),this.SuccessPanel=new Game.Success,this.SuccessPanel.Confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hidePannel,this);var t=new Game.Road;this.addChild(t),this.drawCar(),this.drawButton(),this.MoveInterval=setInterval(this.MoveFunction,this.TimeLimit,this),this.DetectInterval=setInterval(this.detectOut,this.DetectTime,this),this.StartTime=(new Date).getTime()},n.SpeedFunction=function(t){this.SpeedInterval&&clearInterval(this.SpeedInterval),this.SpeedInterval=setInterval(this.MoveOperate,this.SpeedTimeLimit,t.target.name,this)},n.MoveOperate=function(t,e){"forward"==t?e.Speed<e.MaxSpeed&&(e.Speed+=e.SpeedAdd):e.Speed>-e.MaxSpeed&&(e.Speed-=e.SpeedAdd)},n.StopSpeedFunction=function(t){this.SpeedInterval&&(clearInterval(this.SpeedInterval),this.SpeedInterval=null)},n.Stop=function(t){this.Speed=0,this.ForwardButton.enabled=!0,this.BackButton.enabled=!0},n.TurnFunction=function(t){this.TurnInterval&&clearInterval(this.TurnInterval),this.TurnInterval=setInterval(this.TurnOperate,this.TurnTimeLimit,t.target.name,this)},n.TurnOperate=function(t,e){"left"==t?e.Steering.addRot(!0,e.Turns):e.Steering.addRot(!1,e.Turns),e.Turns<=2&&(e.Turns+=e.TurnsLimit)},n.StopTurnFunction=function(t){this.Turns=0,this.TurnInterval&&(clearInterval(this.TurnInterval),this.TurnInterval=null)},n.TurnCalculate=function(t){if(0==t.Steering.Rot)return t.R=0,t.Car.leftWheel.rotation=0,void(t.Car.rightWheel.rotation=0);var e=t.Steering.Rot/540*t.AddRotation*10;if(t.Car.leftWheel.rotation=e,t.Car.rightWheel.rotation=e,t.R=(t.CarLenth-t.WheelDis)/Math.tan(e/180*Math.PI),t.Steering.Rot>0){if(t.LeftFlag){t.MoveInterval&&clearInterval(t.MoveInterval),egret.Tween.removeTweens(t.Car),t.LeftFlag=!1;var i=t.Car.rotation;t.Car.width=-t.CarWidth,t.Car.x+=t.CarWidth*Math.cos(i/180*Math.PI),t.Car.y+=t.CarWidth*Math.sin(i/180*Math.PI),t.Car.changeWay(!1),t.MoveInterval=setInterval(t.MoveFunction,t.TimeLimit,t)}t.LeftFlag=!1}if(t.Steering.Rot<0){if(!t.LeftFlag){t.MoveInterval&&clearInterval(t.MoveInterval),egret.Tween.removeTweens(t.Car),t.LeftFlag=!0;var i=t.Car.rotation;t.Car.width=t.CarWidth,t.Car.x-=t.CarWidth*Math.cos(i/180*Math.PI),t.Car.y-=t.CarWidth*Math.sin(i/180*Math.PI),t.Car.changeWay(!0),t.MoveInterval=setInterval(t.MoveFunction,t.TimeLimit,t)}t.LeftFlag=!0}},n.MoveFunction=function(t){if(t.OldRot!=t.Steering.Rot&&t.TurnCalculate(t),0!=t.Speed){var e,i,n,s,a=5*t.Speed,r=a/t.R,o=t.Car.rotation%360,h=t.Car.x,u=t.Car.y,d=egret.Tween.get(t.Car);if(0==t.R)return n=h+a*Math.sin(o/180*Math.PI),s=u-a*Math.cos(o/180*Math.PI),d.to({x:n,y:s},t.MoveTime),void(t.IsCrash=!1);e=h+t.R*Math.cos(o/180*Math.PI),i=u+t.R*Math.sin(o/180*Math.PI),n=(h-e)*Math.cos(-r)+(u-i)*Math.sin(-r)+e,s=-(h-e)*Math.sin(-r)+(u-i)*Math.cos(-r)+i,d.to({x:n,y:s,rotation:o+r/Math.PI*180},t.MoveTime),t.IsCrash=!1}},n.detectOut=function(t){if(!t.IsCrash){var e=t.Car.x,i=t.Car.y;if(1==t.testResult(e,i)&&(t.collision+=1,t.showPannel(!1),egret.Tween.removeTweens(t.Car),t.Speed=-t.Speed,t.MoveFunction(t),t.Speed=0,t.IsCrash=!0),2==t.testResult(e,i)){t.showPannel(!0);var n=(new Date).getTime(),s=Math.round((n-t.StartTime)/1e3);console.log("start_Time:"+t.StartTime+",now:"+n+",mTime:"+s),t.SuccessPanel.setTimeLabel(s),t.SuccessPanel.setCollision(t.collision),t.Speed=0,egret.Tween.removeTweens(t.Car),t.IsCrash=!0,document.title="我通过直角花了"+s+"秒,碰撞"+t.collision+"次"}}},n.showPannel=function(t){t?this.addChild(this.SuccessPanel):this.addChild(this.WarnPanel)},n.hidePannel=function(t){"warning"==t.target.name?this.removeChild(this.WarnPanel):(this.removeChild(this.SuccessPanel),this.initGame())},n.testResult=function(t,e){var i=this.Car.rotation,n={x:0,y:0},s={x:0,y:0},a={x:0,y:0},r={x:0,y:0};if(this.LeftFlag?(s.x=t,s.y=e,a.x=t+this.CarWidth*Math.cos(i/180*Math.PI),a.y=e+this.CarWidth*Math.sin(i/180*Math.PI),n.x=t+(this.CarLenth-this.CarMinLenth)*Math.sin(i/180*Math.PI),n.y=e-(this.CarLenth-this.CarMinLenth)*Math.cos(i/180*Math.PI),r.x=t+this.CarWidth*Math.cos(i/180*Math.PI)+(this.CarLenth-this.CarMinLenth)*Math.sin(i/180*Math.PI),r.y=e+this.CarWidth*Math.sin(i/180*Math.PI)-(this.CarLenth-this.CarMinLenth)*Math.cos(i/180*Math.PI)):(s.x=t-this.CarWidth*Math.cos(i/180*Math.PI),s.y=e-this.CarWidth*Math.sin(i/180*Math.PI),a.x=t,a.y=e,r.x=t+(this.CarLenth-this.CarMinLenth)*Math.sin(i/180*Math.PI),r.y=e-(this.CarLenth-this.CarMinLenth)*Math.cos(i/180*Math.PI),n.x=t-this.CarWidth*Math.cos(i/180*Math.PI)+(this.CarLenth-this.CarMinLenth)*Math.sin(i/180*Math.PI),n.y=e-this.CarWidth*Math.sin(i/180*Math.PI)-(this.CarLenth-this.CarMinLenth)*Math.cos(i/180*Math.PI)),n.x<=0||s.x<=0||a.x<=0||r.x<=0||n.x>=this.StageWidth-10||s.x>=this.StageWidth-10||a.x>=this.StageWidth-10||r.x>=this.StageWidth-10)return 1;if(n.y<=0||s.y<=0||a.y<=0||r.y<=0||n.y>=this.StageHeight||s.y>=this.StageHeight||a.y>=this.StageHeight||r.y>=this.StageHeight)return 1;for(var o={x:(n.x+s.x)/2,y:(n.y+s.y)/2},h={x:(s.x+a.x)/2,y:(s.y+a.y)/2},u={x:(a.x+r.x)/2,y:(a.y+r.y)/2},d={x:(r.x+o.x)/2,y:(r.y+o.y)/2},l=[n,s,a,r,o,h,u,d],c=0;8>c;c++)if(this.testangle(l[c]))return 1;for(var c=0;4>c;c++)if(l[c].x<=305)return 3;return 2},n.testangle=function(t){return t.x>186&&t.y>357||t.x<33||t.y<225?!0:!1},e}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);